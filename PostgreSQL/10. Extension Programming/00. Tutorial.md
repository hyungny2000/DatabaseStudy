# PostgreSQL Extension ê°œë°œí•˜ê¸°

## 1. ê°œë°œ í™˜ê²½ ì„¤ì •

### í•„ìˆ˜ ë„êµ¬ ì„¤ì¹˜

PostgreSQL í™•ì¥ì„ ê°œë°œí•˜ë ¤ë©´ ë‹¤ìŒ ë„êµ¬ë“¤ì´ í•„ìš”í•©ë‹ˆë‹¤.

- **PostgreSQL** (ì´ë¯¸ ì„¤ì¹˜ë˜ì–´ ìˆë‹¤ë©´ ë²„ì „ í™•ì¸)
- **PostgreSQL ê°œë°œ ë¼ì´ë¸ŒëŸ¬ë¦¬**
  - Ubuntu: `sudo apt install postgresql-server-dev-XX` (XXëŠ” PostgreSQL ë²„ì „)
  - macOS (Homebrew ì‚¬ìš©): `brew install postgresql`
  - Windows: ê³µì‹ ì„¤ì¹˜ íŒ¨í‚¤ì§€ì— í¬í•¨ë¨
- **C ì»´íŒŒì¼ëŸ¬** (`gcc` ë˜ëŠ” `clang`)

## 2. í”„ë¡œì íŠ¸ êµ¬ì¡° ë§Œë“¤ê¸°

PostgreSQL í™•ì¥ì€ Cë¡œ ì‘ì„±ë˜ë©°, í™•ì¥ ëª¨ë“ˆì„ ìƒì„±í•˜ê¸° ìœ„í•´ ëª‡ ê°€ì§€ íŒŒì¼ì´ í•„ìš”í•©ë‹ˆë‹¤. ë‹¤ìŒê³¼ ê°™ì´ ë””ë ‰í„°ë¦¬ë¥¼ ë§Œë“¤ê³  í•„ìš”í•œ íŒŒì¼ì„ ì¶”ê°€í•˜ì„¸ìš”.

```bash
mkdir my_pg_extension
cd my_pg_extension
```

### ê¸°ë³¸ íŒŒì¼

- `my_extension.c` â†’ í™•ì¥ì˜ ì£¼ìš” ì½”ë“œ
- `my_extension.control` â†’ í™•ì¥ ì •ë³´ ì„¤ì • íŒŒì¼
- `my_extension--1.0.sql` â†’ SQL ê°ì²´ ìƒì„± ìŠ¤í¬ë¦½íŠ¸
- `Makefile` â†’ ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸

## 3. C ì½”ë“œ ì‘ì„±

ì´ì œ `my_extension.c` íŒŒì¼ì„ ë§Œë“¤ì–´ ê°„ë‹¨í•œ í•¨ìˆ˜(`add_integers()`)ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

### `my_extension.c`

```c
#include "postgres.h"
#include "fmgr.h"

PG_MODULE_MAGIC;  // PostgreSQL í™•ì¥ ëª¨ë“ˆ ë§¤ì§ ì½”ë“œ

// í•¨ìˆ˜ ì„ ì–¸
PG_FUNCTION_INFO_V1(add_integers);

Datum add_integers(PG_FUNCTION_ARGS) {
    int32 a = PG_GETARG_INT32(0);
    int32 b = PG_GETARG_INT32(1);
    PG_RETURN_INT32(a + b);
}
```

## 4. ì œì–´ íŒŒì¼ ìƒì„±

í™•ì¥ì˜ ì •ë³´ë¥¼ PostgreSQLì— ì•Œë¦¬ê¸° ìœ„í•´ `.control` íŒŒì¼ì„ ì‘ì„±í•©ë‹ˆë‹¤.

### `my_extension.control`

```text
default_version = '1.0'
comment = 'My first PostgreSQL extension'
relocatable = true
```

## 5. SQL ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±

PostgreSQLì´ í•¨ìˆ˜ë¥¼ ì¸ì‹í•  ìˆ˜ ìˆë„ë¡ SQLì„ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.

### `my_extension--1.0.sql`

```sql
CREATE FUNCTION add_integers(integer, integer)
RETURNS integer
AS 'my_extension'
LANGUAGE C IMMUTABLE STRICT;
```

## 6. Makefile ì‘ì„±

PostgreSQLì˜ ë¹Œë“œ ì‹œìŠ¤í…œê³¼ ì—°ë™í•˜ë ¤ë©´ `Makefile`ì„ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.

### `Makefile`

```makefile
MODULES = my_extension
EXTENSION = my_extension
DATA = my_extension--1.0.sql
PG_CONFIG = pg_config
REGRESS = my_extension

ifdef USE_PGXS
PGXS := $(shell $(PG_CONFIG) --pgxs)
include $(PGXS)
else
subdir = contrib/my_extension
top_builddir = ../..
include $(top_builddir)/src/Makefile.global
include $(top_builddir)/contrib/contrib-global.mk
endif
```

## 7. ë¹Œë“œ ë° ì„¤ì¹˜

### ë¹Œë“œ (ì»´íŒŒì¼ ë° ì„¤ì¹˜)

```bash
make
sudo make install
```

### PostgreSQLì— í™•ì¥ ë“±ë¡

```sql
CREATE EXTENSION my_extension;
```

### í•¨ìˆ˜ ì‹¤í–‰ í…ŒìŠ¤íŠ¸

```sql
SELECT add_integers(3, 7);
```

**ì¶œë ¥:**

```
 add_integers
--------------
           10
```

## ë§ˆë¬´ë¦¬

ì´ì œ ê°„ë‹¨í•œ PostgreSQL í™•ì¥ì„ ê°œë°œí•˜ê³  ì‹¤í–‰í•˜ëŠ” ë°©ë²•ì„ ë°°ì› ìŠµë‹ˆë‹¤! í™•ì¥ í”„ë¡œê·¸ë¨ì„ ë” ë°œì „ì‹œí‚¤ë ¤ë©´ ë‹¤ìŒì„ ì¶”ê°€í•´ë³´ì„¸ìš”:

âœ… ë” ë³µì¡í•œ ë¡œì§ ì¶”ê°€\
âœ… ì‚¬ìš©ì ì •ì˜ ë°ì´í„° íƒ€ì… ì¶”ê°€\
âœ… ì»¤ìŠ¤í…€ ì—°ì‚°ì ìƒì„±

í•„ìš”í•œ ë¶€ë¶„ì´ ìˆìœ¼ë©´ ì§ˆë¬¸í•˜ì„¸ìš”! ğŸ˜Š

