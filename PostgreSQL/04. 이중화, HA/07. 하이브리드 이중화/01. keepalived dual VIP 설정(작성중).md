## Keepalivedì—ì„œ í•œ ì„œë²„ì— ë‘ ê°œì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‹¤í–‰í•˜ì—¬ VIPë¥¼ ê°ê° í• ë‹¹í•˜ëŠ” ë°©ë²•

### 1. Keepalived ì¸ìŠ¤í„´ìŠ¤ ë‘ ê°œ ì‹¤í–‰í•˜ê¸°
ê¸°ë³¸ì ìœ¼ë¡œ KeepalivedëŠ” ë‹¨ì¼ í”„ë¡œì„¸ìŠ¤ë¡œ ì‹¤í–‰ë˜ì§€ë§Œ, ì—¬ëŸ¬ ê°œì˜ êµ¬ì„± íŒŒì¼ì„ ì‚¬ìš©í•˜ì—¬ ë‘ ê°œì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### 1-1. Keepalived ì‹œìŠ¤í…œ ì„œë¹„ìŠ¤ ë³µì œ
```bash
# ê¸°ë³¸ keepalived ì„œë¹„ìŠ¤ ë³µì‚¬
sudo cp /etc/keepalived/keepalived.conf /etc/keepalived/keepalived-instance1.conf
sudo cp /etc/keepalived/keepalived.conf /etc/keepalived/keepalived-instance2.conf
```
ì´ì œ ê°ê°ì˜ êµ¬ì„± íŒŒì¼ì„ ìˆ˜ì •í•˜ì—¬ ì„œë¡œ ë‹¤ë¥¸ VIPë¥¼ ê´€ë¦¬í•˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.

---

### 2. Keepalived ì„¤ì • íŒŒì¼ ìˆ˜ì •í•˜ê¸°

#### 2-1. ì²« ë²ˆì§¸ ì¸ìŠ¤í„´ìŠ¤ ì„¤ì • (`/etc/keepalived/keepalived-instance1.conf`)
```bash
vrrp_instance VI_1 {
    state MASTER
    interface eth0
    virtual_router_id 51
    priority 100
    advert_int 1
    authentication {
        auth_type PASS
        auth_pass 1234
    }
    virtual_ipaddress {
        192.168.1.100
    }
}
```

#### 2-2. ë‘ ë²ˆì§¸ ì¸ìŠ¤í„´ìŠ¤ ì„¤ì • (`/etc/keepalived/keepalived-instance2.conf`)
```bash
vrrp_instance VI_2 {
    state MASTER
    interface eth0
    virtual_router_id 52  # virtual_router_idëŠ” ë°˜ë“œì‹œ ë‹¤ë¥´ê²Œ ì„¤ì •í•´ì•¼ í•¨
    priority 100
    advert_int 1
    authentication {
        auth_type PASS
        auth_pass 5678
    }
    virtual_ipaddress {
        192.168.1.101
    }
}
```
ê° ì¸ìŠ¤í„´ìŠ¤ê°€ ë‹¤ë¥¸ VIPë¥¼ ê´€ë¦¬í•˜ë„ë¡ `virtual_router_id` ê°’ì„ ë‹¤ë¥´ê²Œ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.

---

### 3. ë³„ë„ì˜ Keepalived ì„œë¹„ìŠ¤ ì‹¤í–‰í•˜ê¸°

#### 3-1. ë³„ë„ ì„œë¹„ìŠ¤ íŒŒì¼ ë§Œë“¤ê¸°
KeepalivedëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ë‹¨ì¼ ì„œë¹„ìŠ¤ë¡œ ì‹¤í–‰ë˜ë¯€ë¡œ, ë‘ ê°œì˜ ì„œë¹„ìŠ¤ë¥¼ ê°œë³„ì ìœ¼ë¡œ ì‹¤í–‰í•˜ë ¤ë©´ `systemd` ì„œë¹„ìŠ¤ íŒŒì¼ì„ ë³µì œí•˜ì—¬ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

```bash
sudo cp /lib/systemd/system/keepalived.service /etc/systemd/system/keepalived-instance1.service
sudo cp /lib/systemd/system/keepalived.service /etc/systemd/system/keepalived-instance2.service
```

#### 3-2. ì²« ë²ˆì§¸ ì„œë¹„ìŠ¤ ìˆ˜ì • (`/etc/systemd/system/keepalived-instance1.service`)
```ini
[Unit]
Description=Keepalived Instance 1
After=network-online.target

[Service]
ExecStart=/usr/sbin/keepalived -f /etc/keepalived/keepalived-instance1.conf --dont-fork
Restart=always

[Install]
WantedBy=multi-user.target
```

#### 3-3. ë‘ ë²ˆì§¸ ì„œë¹„ìŠ¤ ìˆ˜ì • (`/etc/systemd/system/keepalived-instance2.service`)
```ini
[Unit]
Description=Keepalived Instance 2
After=network-online.target

[Service]
ExecStart=/usr/sbin/keepalived -f /etc/keepalived/keepalived-instance2.conf --dont-fork
Restart=always

[Install]
WantedBy=multi-user.target
```

#### 3-4. ì„œë¹„ìŠ¤ í™œì„±í™” ë° ì‹¤í–‰
```bash
sudo systemctl daemon-reload
sudo systemctl enable keepalived-instance1
sudo systemctl enable keepalived-instance2
sudo systemctl start keepalived-instance1
sudo systemctl start keepalived-instance2
```

---

### 4. ì •ìƒ ë™ì‘ í™•ì¸
ê° ì¸ìŠ¤í„´ìŠ¤ê°€ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ”ì§€ í™•ì¸í•˜ë ¤ë©´ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.
```bash
sudo systemctl status keepalived-instance1
sudo systemctl status keepalived-instance2
```

VIPê°€ ì •ìƒì ìœ¼ë¡œ í• ë‹¹ë˜ì—ˆëŠ”ì§€ë„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
ip addr show
```
ì´ì œ í•œ ì„œë²„ì—ì„œ ë‘ ê°œì˜ Keepalived ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‹¤í–‰í•˜ì—¬ ê°ê° ë‹¤ë¥¸ VIPë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ğŸš€

