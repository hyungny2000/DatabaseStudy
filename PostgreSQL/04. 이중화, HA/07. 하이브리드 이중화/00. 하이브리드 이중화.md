# 하이브리드 이중화

## wal_level = logical
- logical 레벨은 replica 레벨에 logical decoding, 즉 SQL로 변환하기 위한 정보를 추가한 레벨
- logical 레벨이 replica 레벨을 포함하므로, wal_level을 logical로 설정한 상태에서 물리적 동기화도 동작 가능함. (03/10 테스트 완료)
- logical 레벨 설정만으로 하나의 DB클러스터에서 물리적/논리적 이중화 모두 적용 가능함.

## 하이브리드 이중화 (가칭)
- 하나의 DB클러스터에서 물리적/논리적 이중화를 동시에 사용하는 개념.
- 기본적으로 물리적 이중화 클러스터를 구축하고, 목적에 맞는 논리적 이중화를 별도 구축하는 개념.

## Use Case
1. DB업그레이드
   - 기존 구 버전의 물리 이중화 DB를 최신 버전 물리 이중화 DB로 업그레이드.
   - 신/구 버전 간의 데이터 동기화에 논리적 이중화 활용.
2. 외부연계시스템에 맞는 특정 데이터 전송
   - 외부연계시스템 권한에 맞는 데이터만 선별적으로 이중화해야 할 때.
   - 해당 시스템의 사양에 맞게 DB클러스터를 별도 구성하여 필요한 만큼만 이중화할 때 필요.
   - 본 시스템과 R/R과 담당DBA가 전혀 달라 양 측 테이블의 DDL을 각 팀의 담당DBA가 수행해야만 할 때.

## 하이브리드 이중화 구현 필수사항
1. 동일 서비스DB 서버끼리는 repmgr + keepalived를 포함한 물리적 이중화 필요
   - VIP Failover 등을 수행해야 함.
   - 마스터/스탠바이 간의 DB클러스터 구조가 동일해야 운영이 수월해짐.
2. 다른 서비스 간의 DB동기화는 논리적인 pglogical 이중화를 사용해야 함.
   - 서로 다른 서비스를 운영하는 DB간에는 DB클러스터 구조, DB버전이 동일할 수 없다고 봐야 함.
   - DB클러스터 구조, DB버전이 달라도 이중화가 되는 논리적 이중화를 우선 고려해야 함.
   - Replication Set 등의 관리가 까다로운 바닐라 버전보다, pglogical이 더 수월해 보임.
3. Dual VIP 가능
   - 서비스용 VIP와 읽기전용 VIP를 두어 읽기전용VIP를 통해 논리적 이중화를 구현했으면 함.
   - 서비스 VIP 부하경감을 위해 확인은 필요.
