## repmgr계정에서 Superuser 권한 빼기 (v14 ~)

#### 참고자료
[참고 : repmgr db계정 권한 링크](https://www.repmgr.org/docs/current/configuration-permissions.html)

#### repmgr 일반계정에 필요한 권한

###### 1. Replication Role
- replication 롤을 보유한 일반계정
  ```
  create user repmgr with replication encrypted password 'repmgr';
  ```

###### 2. 다음 롤 권한
- pg_read_all_stats : pg_stats로 시작하는 모든 뷰 조회권한
- pg_read_all_settings : 모든 설정값 조회권한
- pg_monitor : 위 두 롤을 포함한 롤, 이 롤 권한 부여하여 대체 가능
- pg_checkpoint : CHECKPOINT 명령 실행가능한 롤 권한.

###### 3. repmgr 확장 생성
- repmgr 계정이 superuser이면 `create extension repmgr` 명령을 자동으로 실행
- `repmgr primary register` 이전에 superuser계정(예 : postgres)으로 `create extension repmgr`을 직접 실행해야 함.

###### 4. 함수 실행권한
- pg_wal_replay_resume() : Failover 시 스탠바이 서버의 WAL Replay 재개를 위해 필요함.
- pg_promote() : 스탠바이 서버의 Promotion을 위해 필요함. 권한 부재시 `pg_ctl promote`로 실행함.

###### 5. 기타
- repmgr.conf에서 `standby_disconnect_on_failover = true`된 경우, repmgr 계정에서 `ALTER SYSTEM`문을 사용. 14버전까지는 superuser로만 `ALTER SYSTEM`명령이 가능했으나, 15버전부터 일반 계정에도 `ALTER SYSTEM`권한 부여 가능함. 아래 명령 사용하여 
ALTER SYSTEM 권한 부여 가능
```sql
GRANT ALTER SYSTEM ON PARAMETER wal_retrieve_retry_interval TO repmgr.
```
