## repmgr 구축방법 완성

#### repmgr 구축방법 요약
1. 이중화 대상, Witness DB구축 (DB버전은 최소 15이상)
2. 노드 간 Passwordless SSH 설정
3. 각 노드에 repmgr 설치 (마스터/스탠바이/Witness)
5. 각 노드에 repmgr.conf 생성
6. 마스터DB에 repmgr 설정
   1. 모든 DB에 일일이 접속하여 create extension repmgr 실행
   2. non-superuser repmgr 계정 생성
   3. repmgr 전용 데이터베이스 생성 (owner repmgr)
   4. pg_hba.conf 파일에 md5인증으로 접속권한 생성
7. 각 서버의 postgres 홈 디렉토리에 .pgpass 생성
8. 마스터 서버에서 `repmgr primary register`로 노드 등록
9. 스탠바이 서버에 STANDBY CLONE 준비
    1. 스탠바이 서버의 데이터 디렉토리 비우기
    2. `repmgr standby clone`으로 스탠바이 서버 구축
10. 스탠바이 서버 기동 및 `repmgr standby register`로 등록
11. Witness 서버에 repmgr 설정
    1. 모든 DB에 일일이 접속하여 create extension repmgr 실행
    2. non-superuser repmgr 계정 생성
    3. repmgr 전용 데이터베이스 생성
    4. pg_hba.conf 파일에 md5인증으로 접속권한 생성
12. Witness서버를 `repmgr witness register`로 witness노드로 등록
13. 모든 노드의 repmgrd 데몬 띄우기 (`repmgrd -f repmgr.conf`)
14. 마스터/스탠바이 노드에 keepalived 패키지 설정 (witness는 제외)
    1. yum -y install keepalived
    2. /etc/keepalived/keepalived.conf 설정파일 생성
    3. /var/lib/pgsql/15/repmgr/keepalived_pgsql_chk.sh 스크립트 생성 후 테스트
    4. systemctl enable keepalived
    5. systemctl start keepalived
    6. ip addr로 VIP점검하기
