## Keepalived 설정파일 시놉시스 ([PDF매뉴얼](https://www.keepalived.org/pdf/UserGuide.pdf))
#### 전체 스크립트
```
vrrp_sync_group string {
group {
string
string
}
notify_master /path_to_script/script_master.sh
(or notify_master “/path_to_script/script_master.sh <arg_list>”)
notify_backup /path_to_script/script_backup.sh
(or notify_backup “/path_to_script/script_backup.sh <arg_list>”)
notify_fault /path_to_script/script_fault.sh
(or notify_fault “/path_to_script/script_fault.sh <arg_list>”)
}
vrrp_instance string {
state MASTER|BACKUP
interface string
mcast_src_ip @IP
lvs_sync_daemon_interface string
virtual_router_id num
priority num
advert_int num
smtp_alert
authentication {
auth_type PASS|AH
auth_pass string
}
virtual_ipaddress { # Block limited to 20 IP addresses
@IP
@IP
@IP
}
virtual_ipaddress_excluded { # Unlimited IP addresses number
@IP
@IP
@IP
}
notify_master /path_to_script/script_master.sh
(or notify_master “/path_to_script/script_master.sh <arg_list>”)
notify_backup /path_to_script/script_backup.sh
(or notify_backup “/path_to_script/script_backup.sh <arg_list>”)
notify_fault /path_to_script/script_fault.sh
(or notify_fault “/path_to_script/script_fault.sh <arg_list>”)
}
```

#### vrrp_sync_group 부분
```
vrrp_sync_group string {
group {
string
string
}
notify_master /path_to_script/script_master.sh
(or notify_master “/path_to_script/script_master.sh <arg_list>”)
notify_backup /path_to_script/script_backup.sh
(or notify_backup “/path_to_script/script_backup.sh <arg_list>”)
notify_fault /path_to_script/script_fault.sh
(or notify_fault “/path_to_script/script_fault.sh <arg_list>”)
}
```
- `group {string string}` : VIP 클러스터 그룹을 이야이하는 듯함. 그 안에는 `vrrp_instance string`로 지정하는 각각의 인스턴스명을 적는 거 같음
- notify_master : BACKUP -> MASTER 상태로 전이될 때 실행할 스크립트 지정
- notify_backup : MASTER -> BACKUP 상태로 전이될 때 실행할 스크립트 지정
- notify_fault : FAILUER가 발생할 때 실행할 스크립트 지정

 #### vrrp_instance 부분
```
vrrp_instance string {
state MASTER|BACKUP
interface string
mcast_src_ip @IP
lvs_sync_daemon_interface string
virtual_router_id num
priority num
advert_int num
smtp_alert
authentication {
auth_type PASS|AH
auth_pass string
}
virtual_ipaddress { # Block limited to 20 IP addresses
@IP
@IP
@IP
}
virtual_ipaddress_excluded { # Unlimited IP addresses number
@IP
@IP
@IP
}
notify_master /path_to_script/script_master.sh
(or notify_master “/path_to_script/script_master.sh <arg_list>”)
notify_backup /path_to_script/script_backup.sh
(or notify_backup “/path_to_script/script_backup.sh <arg_list>”)
notify_fault /path_to_script/script_fault.sh
(or notify_fault “/path_to_script/script_fault.sh <arg_list>”)
}
```


#### vrrp_script 상세 ([출처 : Oracle linux 6 Manual](https://docs.oracle.com/en/operating-systems/oracle-linux/6/admin/section_hxz_zdw_pr.html))
```
vrrp_script script_name {
  script       "program_path arg ..."
  interval i  # Run script every i seconds
  fall f      # If script returns non-zero f times in succession, enter FAULT state
  rise r      # If script returns zero r times in succession, exit FAULT state
  timeout t   # Wait up to t seconds for script before assuming non-zero exit code
  weight w    # Reduce priority by w on fall
}
```
- 이 설명에 따르면
- vrrp_script는 단지 상태전이여부를 판단하는 트래킹 스크립트에 불과함.
- 트래킹 스크립트가 0이 아닌 값이 f번 반복되면 FAULT상태로 전이된다.
- 트래킹 스크립트가 0을 r번 반복하면 FAULT상태를 벗어난다.
- 0이 아닌 코드 값을 반환하기 전에 T초 기다린다???
- W이 양수면 PRIARITY값을 w만큼 떨어트린다.
