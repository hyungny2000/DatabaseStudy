## Keepalived로 VIP관리

#### Keepalived
- DB와는 별개의 솔루션으로 VIP를 전문으로 관리하는 패키지
- VRRP프로토콜을 사용하여 고가용성(High Availability)이 높다고 한다. (뭔 말이야)

#### postrm01,02에 Keepalived 설치
```
yum -y install keepalived
```

#### Keepalived 설정파일 백업 및 확인
```
cd /etc/keepalived
mv /keepalived.conf keepalived.conf.orig
vi keepalived.conf
```

#### keepalived.conf 설정 ([유튜브 영상](https://www.youtube.com/watch?v=EwQSOlspxeU), [블로그](https://dewble.tistory.com/entry/install-keepalived-from-yum-in-centos-7))
```
vrrp_script chk_haproxy {
    script "/usr/bin/killall -0 haproxy"
    interval 2
    weight 4
}
vrrp_instance VI_1 {
    state MASTER
    interface eth0
    virtual_router_id 51
    priority 100
    advert_int 1
    unicast_src_ip ## add local node ip
    unicast_peer {
        ## add peer node ip
    }
    authentication {
        auth_type PASS
        auth_pass 1111
    }
    virtual_ipaddress {
        ## add virtual ip
    }
    track_script{
        chk_haproxy
    }
}
```
- chk_haproxy : 헬스체크하는 스크립트로 추정됨
- unicast_src_ip : 로컬 노드의 IP
- unicast_peer : 이웃 노드의 IP
- virtual_ipaddress : VIP
- track_script : 헬스체크 스크립트를 지정



