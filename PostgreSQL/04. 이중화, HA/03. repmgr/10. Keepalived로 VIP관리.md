## Keepalived로 VIP관리

#### Keepalived
- DB와는 별개의 솔루션으로 VIP를 전문으로 관리하는 패키지
- VRRP프로토콜을 사용하여 고가용성(High Availability)이 높다고 한다. (뭔 말이야)

#### postrm01,02에 Keepalived 설치
```
yum -y install keepalived
```

#### Keepalived 설정파일 백업 및 확인
```
cd /etc/keepalived
mv /keepalived.conf keepalived.conf.orig
vi keepalived.conf
```

#### keepalived.conf 설정 ([유튜브 영상](https://www.youtube.com/watch?v=EwQSOlspxeU), [블로그](https://dewble.tistory.com/entry/install-keepalived-from-yum-in-centos-7))
```
vrrp_script chk_haproxy {
    script "/usr/bin/killall -0 haproxy"
    interval 2
    weight 4
}
vrrp_instance VI_1 {
    state MASTER
    interface eth0
    virtual_router_id 51
    priority 100
    advert_int 1
    unicast_src_ip ## add local node ip
    unicast_peer {
        ## add peer node ip
    }
    authentication {
        auth_type PASS
        auth_pass 1111
    }
    virtual_ipaddress {
        ## add virtual ip
    }
    track_script{
        chk_haproxy
    }
}
```
- chk_haproxy : 헬스체크하는 스크립트로 추정됨
- state : 노드의 초기상태
  - MASTER : 초기 마스터 서버
  - BACKUP : FAILOVER시 마스터가 될 서버
- interface : VIP의 인터페이스
- virtual_router_id : 가상라우터 아이디 (모든 클러스터 내에서 동일해야 함)
- priority : 숫자가 클 수록 우선순위가 높아 우선적으로 마스터가 됨
- advert_int : 상태알림 패킷 전송주기 (1은 1초 단위)
- unicast_src_ip : 로컬 노드의 IP
- unicast_peer : 이웃 노드의 IP
- authentication : VRRP 패킷 인증정설정
  - auth_type PASS : 인증방식 설정 (PASS는 패스워드, AH는 IPSec 인증)
  - auth_pass 1111 : 패스워드 설정 (모든 노드에서 동일해야 함)
- virtual_ipaddress : VIP
- track_script : 헬스체크 스크립트를 지정



