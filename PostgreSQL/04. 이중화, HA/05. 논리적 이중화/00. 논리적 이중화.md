# 논리적 이중화
## 정의
- 물리적 이중화와 달리 마스터 서버에서 실행된 SQL을 스탠바이에 적용하는 방식의 이중화
- postgresql.conf의 `wal_sender = logical` 설정이 되어야 한다.

## publication / subscription
### 정의
- 데이터를 전송하는 객체를 publication, 데이터를 전송받아 적용하는 객체를 subscription이라고 한다.
- publication 1개에 여러 개의 subscription을 연결할 수 있다. subscription이 연결될 때마다 이중화 슬롯이 생성되므로 max_replication_slots 수 만큼 subscription 연결 가능하다.
- publication 객체 생성시 등록하는 테이블, 컬럼 등의 이중화 대상을 **Replication Set**이라고 한다. Replication Set만을 위한 관리 명령어가 주어지지는 않으며, publication 객체에 등록해서 사용한다.

### publication 관리 명령어
1. publication 생성 (모든 테이블 동기화)
   ```sql
   CREATE PUBLICATION MY_PUBLICATION FOR ALL TABLES;
   ```
 2. publication 생성 (대상 테이블 선택)
   ```sql
   CREATE PUBLICATION MY_PUBLICATION FOR TABLE EMPLOYEE, DEPTS;
   ```
3. publication 생성 (특정 스키마 내의 모든 테이블)
   ```sql
   CREATE PUBLICATION MY_PUBLICATION FOR TABLES IN SCHEMA production;
   ```
4. publication 생성 (Insert만 동기화)
   ```sql
   CREATE PUBLICATION MY_PUBLICATION FOR ALL TABLES WITH(publish = 'insert');
   ```
5. EMPLOYEES 테이블의 특정 컬럼만 동기화하도록 publication 생성
   ```sql
   CREATE PUBLICATION MY_PUBLICATION FOR TABLE EMPLOYEE(empid, empname), DEPTS;  
   ```

### subscription 관리 명령어
1. subscription 생성
   ```sql
   CREATE SUBSCRIPTION MY_SUBSCRIPTION CONNECTION 'host=post_publication01 port=5432 dbname=nano' PUBLICATION MY_PUBLICATION;
   ```
2. subscription 활성화/비활성화
   ```
   ALTER SUBSCRIPTION MY_SUBSCRIPTION ENABLE;
   ALTER SUBSCRIPTION MY_SUBSCRIPTION DISABLE;
   ```
3. subscription 데이터 동기화
   ```
   ALTER SUBSCRIPTION MY_SUBSCRIPTION REFRESH PUBLICATION;
   ```
