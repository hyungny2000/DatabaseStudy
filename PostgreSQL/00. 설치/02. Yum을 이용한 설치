Yum을 이용한 PostgreSQL 설치

도커 컨테이너 실행
docker run -d -it --name postdb01 --hostname postdb01 --net mybridge --ip 172.20.0.2 --privileged oraclelinux:8 /sbin/init

도커 컨테이너 접속
docker exec -it postdb01 /bin/bash

로컬 PC에서 PostgreSQL Download 페이지 접속
https://www.postgresql.org/download/
- 각자의 운영체제에 적합한 옵션들을 선택한다.
- 레드햇 리눅스 8계열의 64비트 설치

홈페이지에 제시한 방법으로 설치 진행한다.
root계정으로 실행하면 sudo는 불필요하다.
1) Repository 설치 : sudo dnf install -y https://download.postgresql.org/pub/repos/yum/reporpms/EL-8-x86_64/pgdg-redhat-repo-latest.noarch.rpm
                          (64bit의 리포지토리 기준)
2) Disable built-in PostgreSQL : sudo dnf -qy module disable postgresql
3) PostgreSQL 설치 : sudo dnf install -y postgresql12-server

-- 같이 복사된 스크립트 중 이 이하는 적용하지 않는다. --
sudo /usr/pgsql-13/bin/postgresql-13-setup initdb
sudo systemctl enable postgresql-13
sudo systemctl start postgresql-13

그 밖의 필수 패키지들을 설치한다.
yum -y install net-tools
yum -y install sudo 
yum -y install vim

설치가 완료되면 postgres계정으로 스위치한 다음
.bash_profile에 PGHOME, PATH 환경변수를 다음과 같이 설정하고 저장한다.
su - postgres
vi .bash_profile
export PGHOME=/bin/pgsql-12
export PATH=$PATH:$PGHOME/bin

:wq

.bash_profile을 한 번 실행한다.
. .bash_profile

DB클러스터 초기화
initdb
-- DB클러스터를 초기화한다.
-- 현재는 $PGDATA 환경변수로 지정된 경로인 /var/lib/pgsql/12/data에 파일을 생성한다.
-- 별도의 경로에 초기화를 하려면 initdb -D /custom/path/pgdata 명령을 실행하거나 $PGDATA 환경변수를 수정한다.

DB기동 및 상태확인
1) DB기동
root로 기동시 : systemctl start postgres-12
postgres로 기동시 : pg_ctl start

2) 상태확인
root : systemctl status postgres-12
postgres : pg_ctl status
또는 ps -ef | grep postgres로 확인 가능

DB접속
psql
select * from pg_stat_activity;
-> 쿼리 실행되는지 확인

외부 DB접속을 위한 postgresql.conf, pg_hba.conf 수정
vi $PGDATA/postgresql.conf
listen_addresses='*'
:wq

vi $PGDATA/pg_hba.conf
host      all       postgres     172.0.0.1     trust
:wq

DB재기동
pg_ctl restart

DB툴로 접속 테스트
