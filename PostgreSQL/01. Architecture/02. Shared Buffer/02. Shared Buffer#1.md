## Shared Buffer

#### Shared Buffer 구성요소
1. 해시 테이블
2. 해시 엘리먼트
3. 버퍼 디스크립터
4. 버퍼 풀

#### 해시 테이블 (Hash Table)
1. BufferTag(버퍼의 주민번호같은 것)의 해시함수에 대입한 해시값이 모여 있는 배열
2. 구성요소
   1. 해시버켓 : 해시테이블 배열(Array)에서 요소(Element)에 해당하는 것으로. 버켓 내에는 BufferTag의 해시값을 가지고 있으며, 다음에 이어질 해시 엘리먼트가 이 해시버켓과 연결되어 있다고 보면 된다.
4. 해시테이블은 워낙 많은 프로세스가 동시에 사용하므로 경합의 우려가 있다. 이를 막기 위한 몇 가지 개념이 있다.
   1. 해시 세그먼트 : 해시테이블을 작은 단위로 쪼개놓은 것. 해시테이블에서 **해시충돌**이 발생하면 성능이 저하되는데, 이를 줄이기 위해 큰 테이블을 몇 개의 세그먼트로 쪼개놓았다. 그 쪼개놓은 단위를 해시 세그먼트라고 한다.
   3. 버퍼 파티션 : 해시테이블은 공유리소스로서 프로세스 하나가 점유할 때에는 항상 LWLock(오라클의 Latch에 해당)을 설정해야 한다. LWLock을 설정하면 아무래도 동시에 여러 프로세스가 사용하기에 제약이 있으므로, 이를 방지하기 위해 여러 조각으로 쪼개놓고 조각 1개 당 LWLock 하나를 지정하여 경합을 최소화했다. 이 단위를 버퍼파티션이라 한다. 버퍼파티션 개수는 NUM_BUFFER_PARTITIONS 변수로 설정 가능하다. (하지만 손 대지 않는 것을 추천한다.)

#### 해시 엘리먼트
1. 데이터 엔트리(Data Entry)라고도 불린다.
2. 구성요소
   1. BufferTag의 해시값
   2. BufferTag
   3. 버퍼 디스크립터(Buffer Descriptor)의 배열 인덱스(index)값.
3. BufferTag의 해시값을 통해 해시테이블의 해시버켓과 연결되어 있다.

#### 버퍼 디스크립터 (Buffer Descriptor)
1. 버퍼 풀과 일대일 대응되는 구성요소로, 버퍼의 상태값을 저장하는 배열이다.
2. 해시 엘리먼트에서 버퍼 디스크립터 인덱스값을 가지고 버퍼 디스크립터 내 요소를 탐색할 수 있다.
3. 구성요소
   1. BufferTag
   2. BufferPool Index
   3. state값 : 버퍼의 상태값
   4. 대기중인 backend process의 PID
   5. freeNext : freelist의 다음 인덱스값을 가지고 있다.
   6. LWLock : 버퍼에 엑세스하기 위해 필요한 LWLock이다.
