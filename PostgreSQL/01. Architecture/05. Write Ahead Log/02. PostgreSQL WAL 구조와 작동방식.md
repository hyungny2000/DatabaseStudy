## PostgreSQL WAL 구조와 작동방식

#### XLOG(Transaction Log) 레코드
- 트랜잭션 로그 레코드라고 읽는다.
- 변경내용을 기록하는 최소 단위이다.

#### WAL Dump를 통한 XLOG레코드 분석
waldump는 WAL Segment의 내용을 볼 수 있는 명령어다. 예를 들어 다음 작업을 수행하였다
```
nano=# select pg_current_wal_lsn();
 pg_current_wal_lsn
--------------------
 0/167B2C8
(1 row)

nano=# checkpoint;
CHECKPOINT
nano=# create table test1 (col1 int primary key);
CREATE TABLE
nano=# insert into test1 values (1);
INSERT 0 1
nano=# insert into test1 values (2);
INSERT 0 1
nano=# insert into test1 values (3);
INSERT 0 1
nano=# begin;
BEGIN
nano=# insert into test1 values (4);
INSERT 0 1
nano=# insert into test1 values (5);
INSERT 0 1
nano=# insert into test1 values (6);
INSERT 0 1
nano=# commit;
COMMIT
nano=# begin;
BEGIN
nano=# delete from test1 where col1 = 1;
DELETE 1
nano=# delete from test1 where col1 = 2;
DELETE 1
nano=# delete from test1 where col1 = 3;
DELETE 1
nano=# rollback;
ROLLBACK
nano=# select pg_current_wal_lsn();
 pg_current_wal_lsn
--------------------
 0/1692FC8
(1 row)

nano=# checkpoint;
CHECKPOINT
nano=#
```
이에 대한 waldump결과는 다음과 같다.

```
waldump -s startlsn -e endlsn startwalsegmentfile
```

```
pg_basebackup -D /var/lib/pgsql/12/backups -U postgres -Xs -Fp -P
cd /var/lib/pgsql/12/backups/pg_wal
waldump

```
