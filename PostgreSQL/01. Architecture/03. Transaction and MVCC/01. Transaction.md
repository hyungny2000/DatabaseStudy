## Transaction

#### Transaction이란
DBMS에서 논하는 트랜잭션(Transaction)이란 업무의 최소 단위로 규정하고 있다. 최소 단위란 더 이상 쪼갤 수 없다는 뜻이다. 가령, 매장에서 물건을 거래할 때에는 아래의 두 가지 일이 발생한다.
- 매장에서 상품재고가 차감된다.
- 소비자의 통잔 잔고가 물건값만큼 차감된다.     

물론 현실의 거래는 더 복잡하다만 일단 두 가지만 이야기하자. 이 두 가지 일 중에서 하나라도 생략되면 거래가 성사되지 않기 때문에 두 일은 항상 모두 실행되거나, 차라리 모두 취소되서 처음부터 다시 하게 해야 한다. 즉 두 가지 일을 하지만 하나의 업무단위처럼 취급해야 하는데, 데이터베이스에선 업무의 최소단위를 트랜잭션이라고 부른다. 트랜잭션은 실제로 거래라는 뜻을 지닌다.

#### 트랜잭션의 ACID 특성
###### Atomicity (원자성)
여러 업무를 하나의 업무단위로 처리해야 한다. 모두 정상완료되어 처리되거나, 하나라도 이상이 생기면 모두 취소되는 특성이 있다.

###### Consistency (일관성)
데이터의 무결성을 보장해야 한다. 위 물건 거래의 예에서 물건 값을 만원을 치렀다면, 소비자 통장에서 만원이 차감되고, 매장의 매출은 만원 증가해야 한다.

###### Isolation (격리성)
다른 트랜잭션(업무)의 방해를 받지 않고 트랜잭션을 처리해야 한다. 위의 예에서 옆 계산대의 거래에 의한 영향은 전혀 받지 않아야 한다.

###### Durability (견고성)
트랜잭션이 완료된 다음에는 데이터가 영구히 저장되어야 한다. 어떤 장애가 발생해도 데이터는 그대로 보존되어야 한다. 위 예시에서 내가 계산한 거래내역은 시스템 장애에 상관없이 영구보존되어야 한다.

#### 트랜잭션 격리레벨
###### Read Uncomitted
아직 진행중인 다른 트랜잭션의 변경내용을 볼 수 있는 단계로, 격리레벨 중에 가장 낮다. 거의 사용되지 않는 레벨이다.

###### Read Committed
진행중인 다른 트랜잭션의 변경내용은 볼 수 없고, 오직 완료된(Committed) 트랜잭션의 내용만 볼 수 있다. 가장 보편적으로 설정되는 격리레벨이다.

###### Repeatable Read
이 격리레벨을 이해하려면 특정한 상황을 예로 들어야 한다. 예를 들어 ATM기계에서 만원을 인출하는 상황을 예로 들면
1. ATM기계에서 내 통장 잔고를 SELECT를 통해 조회한다. 통장잔고는 2만원이다. 이제 막 만원 인출을 신청했다.
2. 그와 동시에 누군가 내 통장에서 2만원을 모두 인출해 갔다. 통장잔고는 0원이다.
3. 통장 잔고가 0원이므로 ATM기계에서 만원 인출에 실패했다.

1번과 3번 사이에 누군가 내 통장 잔고를 모두 인출하는 상황으로 Read Committed 레벨에선 실현 가능하다. 이러한 상황을 방지하기 위해 내 통장잔고에 해당하는 테이블 1개 Row를 Lock을 걸어야 하는데, 이 격리레벨을 Read Committed라고 한다. Select쿼리만 실행해도 Lock을 걸기 때문에 동시성은 상당히 저하된다.

###### Serializable Read
Select 쿼리 실행시 테이블 전체를 Lock을 거는 격리레벨이다. 동시성을 상당히 떨어뜨리므로 DB성능저하를 야기할 수 있다.

