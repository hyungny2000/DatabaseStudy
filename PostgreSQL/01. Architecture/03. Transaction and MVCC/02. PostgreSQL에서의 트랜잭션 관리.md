## PostgreSQL에서의 트랜잭션 관리

#### Txid (Transaction ID)
- 트랜잭션 시작 시 트랜잭션 매니저로부터 부여받는 일련번호
- 32비트 (8바이트)의 unsigned integer 형으로, 약 42억 정도 된다.
- 예약된 TxID
  - 0 : 쓰지 않는 TxID
  - 1 : 부트스트랩TxID. initdb시점에 사용됨
  - 2 : Frozen TxID. PostgreSQL 9.5 이전 버전에선 Vacuum Freeze시에 2로 설정함
  - 3 : 일반적인 TxID.

#### TxID Wraparound
- TxID는 3부터 42억까지 증가하는 일련번호이므로, 언젠가는 반드시 42억에 도달하게 된다.
- 42억에 도달하면 TxID는 다시 3부터 시작하게 되는 현상을 TxID Wraparound 현상이라고 한다.
- 원래 TxID가 크면 클 수록 최신 또는 미래의 트랜잭션, 작을 수록 과거의 트랜잭션으로 간주하나, Wraparound가 발생하면 현재의 TxID 3번이 과거 TxID 41억번보다 최신이 되는 이상현상이 생긴다.
- 이 이상현상을 막기 위해 Vacuum Freeze를 실시하여, 과거 TxID를 2로 변경하게 된다. 2는 3보다 작으므로 Vacuum Freeze 이전의 모든 데이터는 현재보다 과거임이 보장된다.

#### 트랜잭션 예시
```sql
BEGIN

SELECT BALANCE FROM TB_ACCOUNT WHERE ACCOUNT_OWNER='OH';

UPDATE TB_ACCOUNT
   SET BALANCE = BALANCE - 10000
WHERE ACOUNT_OWNER='OH';

COMMIT;
```
- TxID는 BEGIN 이후의 처음 명령이 시작될 때 부여된다. 위 예시에선 `SELECT` 명령에서부터 TxID가 부여된다. 이 TxID는 `COMMIT` 명령으로 트랜잭션이 종료될 때까지 유효하다. SELECT와 UPDATE명령 모두 BEGIN ~ COMMIT 블록 안에서 실행한 명령어이므로 이 두 명령의 TxID는 동일하다.
