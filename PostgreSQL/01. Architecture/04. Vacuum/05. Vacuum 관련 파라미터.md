## Vacuum 관련 파라미터

#### vacuum_freeze_min_age
얼마 이상 나이든(aged) 행을 Freezing할지 정하는 파라미터로, 이 값이 작으면 작을 수록 보다 이른 시점에 해당 튜플이 Frozen상태로 변환됨을 의미.    
###### 파라미터 값이 지나치게 작으면...
파라미터 값이 지나치게 작다는 말은 튜플이 생성된 지 얼마 지나지 않아 Frozen된다는 뜻이다. 예를 들어 파라미터 값이 100으로 설정되었다고 가정하고 다음 예시를 보자.
1. 보통 생성된 지 얼마 안된 튜플은 이른 시기에 수정/삭제될 가능성이 높다.
2. 파라미터 값이 작게 설정되어 있으면, 생성된지 얼마 안된 튜플이 Frozen된다. 예를 들어 `insert into tab1 values ('PostgreSQL');`을 실행했다고 가정하자. 이 때 할당받은 XID는 100이다. 이후 Age(XMIN)=100이 되어 1번 튜플은 Frozen상태가 되었다.
   
   |LP| XMIN |XMAX |XMIN_FROZEN | DATA |
   | --- | --- | --- | --- | --- |
   | 1 | 100 | 0 | True | 'PostgreSQL' |
3. 곧이어 Frozen된 튜플이 `update tab1 set data='Good';`쿼리에 의해 Dead Tuple이 되고, 신규 버전의 튜플은 새 XID인 201을 할당받는다.

   |LP| XMIN |XMAX |XMIN_FROZEN | DATA |
   | --- | --- | --- | --- | --- |
   | 1 | 100 | 201 | True | 'PostgreSQL' |
   | 2 | 201 | 0  | False | 'Good' |
5. 추후 XMIN=201인 튜플도 Age대상이 되어 vacuum이 되면서 다음과 같이 된다. Dead Tuple은 제거되고, 2번 튜플이 Frozen되었다. 

   |LP| XMIN |XMAX |XMIN_FROZEN | DATA |
   | --- | --- | --- | --- | --- |
   | 1 |  |  |  |  |
   | 2 | 201 | 0  | True | 'Good' |
프로덕션DB에서 트랜잭션 100은 너무 짧은 순간이다. 파라미터 값이 적당히 컸다면 최초 Insert된 튜플은 Frozen되지 않고 바로 삭제되어, 서버 리소스의 낭비를 줄였을 것이다.

###### 파라미터 값이 지나치게 크다면
당연히 XID Wraparound가 발생하여 데이터 손실이 발생한다. 예시는 안들어도 될 듯 하다.

###### 권고값
ChatGPT에 따르면, 적당한 값은 100만 ~ 150만 정도라고 한다.

   


#### vacuum_freeze_table_age


